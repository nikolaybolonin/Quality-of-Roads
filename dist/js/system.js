"use strict";function initAutocomplete(){var e=new google.maps.LatLng(lat,lng),t=new google.maps.Map(document.getElementById("map_with_google_api"),{center:e,zoom:zoom,maxZoom:19,mapTypeId:"OSM",mapTypeControlOptions:{mapTypeIds:["roadmap","hybrid","OSM"],position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}});t.mapTypes.set("OSM",new google.maps.ImageMapType({getTileUrl:function(e,t){var o=1<<t,r=e.x%o;return r<0&&(r=o+r),"http://tile.openstreetmap.org/"+t+"/"+r+"/"+e.y+".png"},tileSize:new google.maps.Size(256,256),name:"OpenStreetMap",maxZoom:20}));var o=document.getElementById("map_address_input"),r=new google.maps.places.SearchBox(o);t.addListener("bounds_changed",function(){r.setBounds(t.getBounds())});var a=[];r.addListener("places_changed",function(){var e=r.getPlaces();if(0!=e.length){a.forEach(function(e){e.setMap(null)}),a=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){var r={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};a.push(new google.maps.Marker({map:t,icon:r,title:e.name,position:e.geometry.location})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}),t.fitBounds(o)}}),t.data.addGeoJson(jsonGeoData);var n=document.getElementById("map_current_parameters_label"),i=1e7,s=$("#go_to_coords"),l=document.getElementById("selected_line_options");t.addListener("zoom_changed",function(){n.value="Zoom: "+t.getZoom()}),t.addListener("center_changed",function(){var e=Math.round(t.getCenter().lat()*i)/i,o=Math.round(t.getCenter().lng()*i)/i;n.value="Center: ("+o+", "+e+")"}),t.addListener("click",function(e){var t=Math.round(e.latLng.lat()*i)/i,o=Math.round(e.latLng.lng()*i)/i;n.value="Coords: ("+o+", "+t+")",l.innerHTML=""}),$(document).on("click keydown","#meta_data_container",function(e){(13==e.keyCode||(e.keyCode=s.is(e.target)||!(0===s.has(e.target).length)))&&alert(n.value)}),t.data.setStyle(function(e){var t="gray",o=3,r=6;return 1!=e.getProperty("isColorful")&&void 0!=e.getProperty("isColorful")||(t=e.getProperty("color"),o=2,r=5),{fillColor:t,strokeColor:t,strokeWeight:r,zIndex:o}}),t.data.addListener("click",function(e){var t=Math.round(e.latLng.lat()*i)/i,o=Math.round(e.latLng.lng()*i)/i;n.value="Coords: ("+o+", "+t+")",1!=e.feature.getProperty("isColorful")&&void 0!=e.feature.getProperty("isColorful")?e.feature.setProperty("isColorful",!0):e.feature.setProperty("isColorful",!1)});var u=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(0,(-10)),disableAutoPan:!0});t.data.addListener("mouseover",function(e){t.data.revertStyle(),t.data.overrideStyle(e.feature,{strokeColor:"gray",strokeWeight:8,zIndex:4})}),t.data.addListener("mousemove",function(e){u.open(t),u.setPosition(e.latLng);var o="";void 0!=e.feature.getProperty("name")&&(o=o+"Name: "+e.feature.getProperty("name")+"</br>"),void 0!=e.feature.getProperty("id")&&(o=o+"ID: "+e.feature.getProperty("id")+"</br>"),void 0!=e.feature.getProperty("surface")&&(o=o+"Surface: "+e.feature.getProperty("surface")+"</br>"),void 0!=e.feature.getProperty("width")&&(o=o+"Width: "+e.feature.getProperty("width")+"m</br>"),void 0!=e.feature.getProperty("populousness")&&(o=o+"Populousness: "+e.feature.getProperty("populousness")+"</br>"),void 0!=e.feature.getProperty("quality")&&(o=o+"Quality: "+e.feature.getProperty("quality")+"</br>"),void 0!=e.feature.getProperty("rating")&&(o=o+"Rating: "+e.feature.getProperty("rating")+"</br>"),void 0!=e.feature.getProperty("color")&&(o=o+"Color: "+e.feature.getProperty("color")+"</br>"),void 0!=e.feature.getProperty("descendants")&&(o=o+"Descendants: "+e.feature.getProperty("descendants")+"</br>"),u.setContent(o)}),t.data.addListener("mouseout",function(e){t.data.revertStyle(),u.close(t)}),t.data.addListener("click",function(e){var t="";void 0!=e.feature.getProperty("name")&&(t=t+"Name: "+e.feature.getProperty("name")+"</br>"),void 0!=e.feature.getProperty("id")&&(t=t+"ID: "+e.feature.getProperty("id")+"</br>"),void 0!=e.feature.getProperty("surface")&&(t=t+"Surface: "+e.feature.getProperty("surface")+"</br>"),void 0!=e.feature.getProperty("width")&&(t=t+"Width: "+e.feature.getProperty("width")+"m</br>"),void 0!=e.feature.getProperty("populousness")&&(t=t+"Populousness: "+e.feature.getProperty("populousness")+"</br>"),void 0!=e.feature.getProperty("quality")&&(t=t+"Quality: "+e.feature.getProperty("quality")+"</br>"),void 0!=e.feature.getProperty("rating")&&(t=t+"Rating: "+e.feature.getProperty("rating")+"</br>"),void 0!=e.feature.getProperty("color")&&(t=t+"Color: "+e.feature.getProperty("color")+"</br>"),void 0!=e.feature.getProperty("descendants")&&(t=t+"Descendants: "+e.feature.getProperty("descendants")+"</br>"),l.innerHTML=t})}window.onload=function(){function e(e){e=e||{},e.url=void 0==e.url?"ajax.php":e.url,e.request=void 0==e.request?"200":e.request;var t=e.url,o=e.request;return new Promise(function(e,r){var a=new XMLHttpRequest;a.open("GET",t+"?r="+Math.random()+"&request="+o,!0),a.onload=function(){if(200==this.status)e(this.response);else{var t=new Error(this.statusText);t.code=this.status,r(t)}},a.onerror=function(){r(new Error("Network Error"))},a.send()})}function t(e){e=e||{},e.container=void 0==e.container?"chart_container":e.container,e.data=void 0==e.data?[{name:"Книга",y:900}]:e.data;var t=this;this.container=e.container,this.data=e.data,this.refreshData=function(e){e=e||{},e.data=void 0==e.data?t.data:e.data;var o=e.data,r=t.container;Highcharts.chart(r,{chart:{type:"column",backgroundColor:"#FAFAFA"},title:{text:"Диаграмма распределения выручки от продажи различных товаров"},subtitle:{text:"До нажатия кнопки Обновить выводятся дефолтные данные. Ничего от себя добавлять не стал, даже стили. Если нужно было навести красоту или прикрутить более комплексные фичи Highcharts - напишите, до пятницы сделаю. Не стал делать намеренно чтобы выполнить исключительно условия задачи."},xAxis:{type:"category"},yAxis:{title:{text:"Выручка в рублях"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y} руб."}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f} рублей</b><br/>'},series:[{name:"Выручка",colorByPoint:!0,data:o}]})}}function o(t){var o=document.getElementById("refresh_chart");o.addEventListener("click",function(o){e({url:"php/ajax.php",request:"select_earnings"}).then(function(e){console.info("Fulfilled");var t=JSON.parse(e);return t},function(e){return console.error("Rejected: "+response),!1}).then(function(e){if(e.result){var o=[];for(var r in e.data)e.data[r].y=+e.data[r].y,o.push(e.data[r]);t.refreshData({data:o}),console.log(o)}else console.error(e.info)}),o.preventDefault()},!1)}var r=new t({container:"chart_container",data:[{name:"Книга",y:900},{name:"Телефон",y:3500},{name:"Кросовок",y:2e3},{name:"Ноутбук",y:25e3}]});r.refreshData(),o(r)};var jsonGeoData={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"footway",id:1111,surface:"paved",width:2.5,populousness:3,quality:4,rating:3,color:"yellow",descendants:"1234, 1235, 4231"},geometry:{type:"MultiLineString",coordinates:[[[30.35757690668106,59.943845964069844],[30.355632305145264,59.943875]]]}},{type:"Feature",properties:{name:"footway",quality:"4",color:"yellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355326533317566,59.943875],[30.355299711227417,59.943279052679095]]]}},{type:"Feature",properties:{name:"footway",quality:"4",color:"yellow"},geometry:{type:"MultiLineString",coordinates:[[[30.35469889640808,59.94328845650161],[30.355299711227417,59.943279052679095]]]}},{type:"Feature",properties:{name:"footway",quality:"5",color:"greenyellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355632305145264,59.943875],[30.355321168899536,59.94388]]]}},{type:"Feature",properties:{name:"footway",quality:"5",color:"greenyellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355632305145264,59.943875],[30.355637669563293,59.94404075366086]]]}},{type:"Feature",properties:{name:"footway",quality:"5",color:"greenyellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355331,59.94404478377827],[30.355321168899536,59.94388]]]}},{type:"Feature",properties:{name:"footway",id:1111,surface:"paved",width:2.5,populousness:3,quality:5,rating:3,color:"greenyellow",descendants:"1234, 1235, 4231"},geometry:{type:"MultiLineString",coordinates:[[[30.355632305145264,59.943875],[30.355605483055115,59.94312187410796]]]}},{type:"Feature",properties:{name:"footway",quality:"5",color:"greenyellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355305075645447,59.943279052679095],[30.35562962293625,59.94327770927567]]]}},{type:"Feature",properties:{name:"footway",quality:"5",color:"greenyellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355305075645447,59.943279052679095],[30.35529300570488,59.943158146152065]]]}},{type:"Feature",properties:{name:"footway",quality:"5",color:"greenyellow"},geometry:{type:"MultiLineString",coordinates:[[[30.355288982391357,59.94308291520162],[30.35559743642807,59.94308022837879]]]}},{type:"Feature",properties:{name:"footway",id:1111,surface:"paved",width:2.5,populousness:3,quality:2,rating:3,color:"red",descendants:"1234, 1235, 4231"},geometry:{type:"MultiLineString",coordinates:[[[30.35529300570488,59.943158146152065],[30.35483568906784,59.94316687830489]]]}},{type:"Feature",properties:{name:"footway",quality:"2",color:"red"},geometry:{type:"MultiLineString",coordinates:[[[30.35529300570488,59.943158146152065],[30.355283617973328,59.94294454354344]]]}},{type:"Feature",properties:{name:"footway",quality:"2",color:"red"},geometry:{type:"MultiLineString",coordinates:[[[30.35474583506584,59.94388895221593],[30.35532519221306,59.94387753349507]]]}},{type:"Feature",properties:{name:"footway",quality:"2",color:"red"},geometry:{type:"MultiLineString",coordinates:[[[30.355614870786667,59.943243452469716],[30.357611775398254,59.94320113518995]]]}},{type:"Feature",properties:{name:"footway",quality:"6",color:"limegreen"},geometry:{type:"MultiLineString",coordinates:[[[30.35559743642807,59.94312590433706],[30.35757690668106,59.94308022837879]]]}},{type:"Feature",properties:{name:"footway",quality:"6",color:"limegreen"},geometry:{type:"MultiLineString",coordinates:[[[30.35559743642807,59.94312590433706],[30.355589389801025,59.94292842253599]]]}}]},lat=59.94357081225065,lng=30.356389311114533,zoom=18;